import{j as g}from"./jsx-runtime.REeFFd-0.mjs";import{u as S,F,r as t,P as h,a as w}from"./react-server/client/context.DPdp0zqd.mjs";function L({remote:u=!1,defer:r=!1,request:f,children:m}){const{url:a,outlet:e}=t.useContext(F),v=S(),{registerOutlet:K,subscribe:n,getFlightResponse:o,abort:O}=v,[{resourceKey:E,error:x,Component:R},y]=t.useState({resourceKey:0,error:null,Component:m||(e===h||u?o?.(a,{outlet:e,remote:u,defer:r,request:f}):null)}),p=t.useRef(null),b=t.useRef(null),_=t.useRef(R);if(t.useEffect(()=>{let s=!0;const C=K(e,a),A=n(e||a,async(T,l,d)=>{if(typeof l.Component<"u"){const c=new DOMException("render","AbortError");O(e,c),b.current?.reject(c),y(i=>({...i,resourceKey:i.resourceKey+1,error:p.current,Component:l.Component})),d(null,l.Component);return}let P,j;const D=new Promise((c,i)=>{P=c,j=i,b.current={resolve:c,reject:i}}),G=o(T,{...l,outlet:e,remote:u,request:f,onReady:l.callServer?void 0:P,onAbort:l.callServer?void 0:j});if(l.callServer)d(null,G);else if(s){l.fallback&&t.startTransition(()=>{y(c=>({...c,resourceKey:c.resourceKey+1,error:p.current,Component:l.fallback}))});try{const c=await D;b.current=null,t.startTransition(()=>{y(i=>({...i,resourceKey:i.resourceKey+1,error:p.current,Component:c})),d(null,c)})}catch{b.current=null}}});return()=>{s=!1,C(),A()}},[a,e,u,f,n,o]),t.useEffect(()=>{(m||e!==h&&R)&&y(s=>({...s,resourceKey:s.resourceKey+1,error:p.current,Component:m}))},[m]),t.useEffect(()=>{(u||r)&&o(a,{outlet:e,remote:u,defer:r,request:f,fromScript:!r,onReady:s=>{s&&t.startTransition(()=>y(C=>({...C,resourceKey:C.resourceKey+1,error:p.current,Component:s})))}})},[a,e,u,r,f,o]),t.useEffect(()=>{const s=new AbortController;return window.addEventListener(`__react_server_flight_error_${e}__`,C=>{p.current=C.detail.error},{signal:s.signal}),()=>s.abort()},[e]),x){if(e===h)return g.jsx(w.Provider,{value:{resourceKey:E,error:x},children:_.current});throw x}return _.current=R,g.jsx(w.Provider,{value:{resourceKey:E,error:x},children:R})}function k({url:u,outlet:r=null,remote:f,defer:m,request:a,children:e}){const{navigate:v,abort:K}=S();return g.jsx(F.Provider,{value:{url:u,outlet:r,refresh(n={}){return refresh(r,n)},prefetch(n,o={}){return prefetch(n,{outlet:r,...o})},navigate(n,o={}){return v(n,{outlet:r,...o})},replace(n,o={}){return replace(n,{outlet:r,...o})},abort(n){return K(r,n)}},children:g.jsx(L,{remote:f,defer:m,request:a,children:e})})}export{k as R};
